// Compile _pb2.py with 
// protoc -I=$SRC_DIR --python_out=$DST_DIR $SRC_DIR/STGProto.proto
// e.g. protoc --python_out=../STG/ STGProto.proto
// or for same folder ops just
// protoc --python_out=. STGProto.proto
// replace python_out with csharp_out for .cs file

syntax = "proto3";

package stg_levelset_proto;
option csharp_namespace = "STG";

// Optimized for editors and sharing. Setup Gameboard from Level.
message Level {

}

// Optimized for in-memory gameplay. Setup from Level.
message Gameboard {
    int32 size_x = 1;
    int32 size_y = 2;
    int32 size_z = 3;
    int32 tick = 4;
    Gamestate gamestate = 5;
    map<int32, bool> globals = 6;

    // p = z * (size_x + size_y) + y * size_x + x
    // x = (p % size_z) % size_x
    // y = (p % size_z) // size_x
    // z = p // size_z
    map<int32, Cell> map = 7;
}

message Cell {
    Element terrain = 1;
    Element alt_terrain = 2;
    Element terrain_modifier = 3;
    Element pickup = 4;
    Element mob = 5;
    Element top = 6;
    Element north = 7;
    Element east = 8;
    Element south = 9;
    Element west = 10;
}

message Element {
    ElemId id = 1;
    int32 rule = 2;
    Color color = 3;
    int32 channel = 4;
    Direction dir = 5;
    int32 count = 6; // Use for inventory counts or piles of items, e.g.
    repeated Element inventory = 7;
    map<string, int32> tags = 8; // is_forced, sliding, etc.
}

message Input {
    Direction primary = 1;
    Direction secondary = 2;
    int32 action = 3; // 0 indicates no action. Likely limit to 1, 2, or 3.
}

enum ElemId {
    ELEMENT_UNDEFINED = 0;

    // TERRAIN
    SPACE = 1;
    FLOOR = 2;
    WALL = 3; // APPEARING, INVISIBLE, BLUE 
    EXIT = 4;
    WATER = 5;
    FIRE = 6;
    DIRT = 7;
    GRAVEL = 8;
    ICE = 9;
    FORCE =10;
    CLONER = 11;
    HINT = 12;
    CHECKPOINT = 13;

    // NESW
    PANEL = 100; // TOGGLE, FORCE, POPUP
    CORNER = 101;

    // TERRAIN_MODIFIER
    BUTTON = 200; // STEPON, ROCKER, ALLON
    DOOR = 201;
    SOCKET = 202;
    THIEF = 203; // KEY, ITEM
    TELEPORT = 204;
    TRAP = 205;
    TOGGLE = 501; // Toggles between terrain layers. GFX should allow hotkey for viewing the alternate layer.
    POPUP = 502; // Exposes the terrain layers. GFX should allow hotkey for viewing the alternate layer.

    // PICKUP
    CHIP = 300;
    KEY = 301; // SINGLE_USE, FOREVER_USE
    ITEM = 302; //FLIPPER, FIREBOOTS, SKATES, SUCTIONBOOTS
    BOMB = 303;

    // MOB
    PLAYER = 400;
    BLOCK = 401;
    MONSTER = 402;
    TANK = 403;

    // TOP
    CANOPY = 500;
}

enum Gamestate {
    GAMESTATE_UNDEFINED = 0;
    PLAY = 1;
    LOSE = 2;
    WIN = 3;
}

enum Color {
    COLOR_UNDEFINED = 0;
    RED = 1;
    BLUE = 2;
    GREEN = 3;
    YELLOW = 4;
    CYAN = 5;
    MAGENTA = 6;
    ORANGE = 7;
    BROWN = 8;
}

enum Direction {
    DIRECTION_UNDEFINED = 0;
    N = 1;
    E = 2;
    S = 3;
    W = 4;
    NE = 5;
    SE = 6;
    SW = 7;
    NW = 8;
    RANDOM = 9;
}